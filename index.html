<head>
<meta charset="utf-8" />
<title>Dehong Pathways Selector / å¾·é—³è¯¾ç¨‹è·¯å¾„é€‰æ‹©å™¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* ============================================================
   Dehong Pathways Selector â€“ Core Layout & Styling
   ============================================================ */

/* ---- BRAND COLOURS ---- */
:root {
  --red: #E4002B;
  --red-soft: #FFE6EA;
  --blue: #009ED0;
  --blue-soft: #E6F7FC;
  --purple: #9B0465;
  --purple-soft: #FCE6F4;
  --green: #97D700;
  --green-soft: #F2FBE4;
  --orange: #FF5100;
  --orange-soft: #FFF0E6;
  --yellow: #FFB900;
  --yellow-soft: #FFF7D9;
  --gold: #A08E00;
  --gold-soft: #F9F5DA;

  --card-radius: 20px;
  --shadow-soft: 0 4px 14px rgba(0,0,0,0.08);
  --shadow-lift: 0 10px 25px rgba(0,0,0,0.15);
}

/* ---- RESET ---- */
body {
  margin: 0;
  background: #151927;
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  color: #F5F5F7;
  min-height: 100vh;
  overflow: auto;
}

/* ============================================================
   Three-column Layout
   ============================================================ */
main {
  display: grid;
  grid-template-columns: 280px 1fr 1fr;
  min-height: 100vh;
  background: transparent;
}

/* Left = instructions */
#instructions {
  background: linear-gradient(180deg, #191D2A, #22263A);
  border-right: 1px solid #2A3040;
  padding: 20px;
  overflow-y: auto;
}

#instructions h2 {
  margin: 0 0 10px;
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--red);
}

#instructions p {
  margin: 6px 0;
  font-size: 0.95rem;
  color: #D7DAE8;
}

#student-info {
  margin-top: 14px;
  margin-bottom: 16px;
  padding: 14px 14px 12px;
  border-radius: 18px;
  background: radial-gradient(circle at top left, rgba(0,158,208,0.32), #151821);
  box-shadow: 0 10px 26px rgba(0,0,0,0.65);
  border: 1px solid #3A4A6A;
  position: relative;
  overflow: hidden;
}

/* Accent strip to signal â€œstart hereâ€ */
#student-info::before {
  content: "Start here / ä»è¿™é‡Œå¼€å§‹";
  position: absolute;
  top: 8px;
  right: 14px;
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 0.7rem;
  letter-spacing: 0.02em;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.15);
  color: #E0F4FF;
}

/* Slight glow at the bottom edge */
#student-info::after {
  content: "";
  position: absolute;
  left: 10%;
  right: 10%;
  bottom: -12px;
  height: 24px;
  background: radial-gradient(circle, rgba(0,158,208,0.45), transparent 60%);
  opacity: 0.6;
  pointer-events: none;
}

#student-info h3 {
  margin: 0 0 8px;
  font-size: 1rem;
  font-weight: 700;
  color: #F5F5F7;
}

#student-info label {
  font-size: 0.9rem;
  color: #E0E3F0;
}

#student-info input,
#student-info select {
  background: #0F1118;
  color: #F5F5F7;
  border: 1px solid #3A3F55 !important;
  border-radius: 8px;
}

/* ============================================================
   MIDDLE PANEL â€” AVAILABLE COURSES (GRID)
   ============================================================ */
#available {
  background: #1A1F30;
  padding: 20px;
  overflow-y: auto;
}

#available h2 {
  margin: 0 0 14px;
  font-size: 1.25rem;
  font-weight: 700;
  color: #F5F5F7;
}

#available-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 14px;
}

/* ---- COURSE CARDS ---- */
.card {
  background: #151821;
  border: 2px solid #2D3244;
  border-radius: var(--card-radius);
  padding: 16px;
  cursor: grab;
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  transition: 0.28s cubic-bezier(.16,1,.3,1);
  display: flex;
  flex-direction: column;
  gap: 4px;
  animation: fadeIn 0.35s ease;
  color: #F5F5F7;
}

.card:hover {
  transform: translateY(-6px) scale(1.03);
  box-shadow: var(--shadow-lift);
}

/* ---- Card Titles ---- */
.card-title {
  font-size: 1rem;
  font-weight: 700;
}

.card-title-zh {
  font-size: 0.9rem;
  opacity: 0.7;
}

/* ---- Colour-coded card classes ---- */
.card.red {
  background: linear-gradient(145deg, #3E0613, #E4002B);
  border-color: #E4002B;
}

.card.blue {
  background: linear-gradient(145deg, #041E2A, #009ED0);
  border-color: #009ED0;
}

.card.purple {
  background: linear-gradient(145deg, #2B0420, #9B0465);
  border-color: #9B0465;
}

.card.green {
  background: linear-gradient(145deg, #172308, #97D700);
  border-color: #97D700;
}

.card.orange {
  background: linear-gradient(145deg, #2E1204, #FF5100);
  border-color: #FF5100;
}

.card.yellow {
  background: linear-gradient(145deg, #2C2304, #FFB900);
  border-color: #FFB900;
}

.card.gold {
  background: linear-gradient(145deg, #282106, #A08E00);
  border-color: #A08E00;
}

/* ============================================================
   RIGHT PANEL â€” PATHWAY BLOCKS
   ============================================================ */
#pathway {
  background: #1A1F30;
  padding: 20px;
  border-left: 1px solid #2A3040;
  overflow-y: auto;
}

#pathway h2 {
  margin: 0 0 14px;
  font-size: 1.25rem;
  font-weight: 700;
  color: #F5F5F7;
}

#blocks {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 16px;
}

/* ---- Block ---- */

.block {
  background: #151821;
  border: 2px dashed #3A3F55;
  border-radius: var(--card-radius);
  padding: 16px;
  min-height: 140px;
  position: relative;
  transition: 0.3s ease;
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
}

.block-red {
  border-color: var(--red);
  background: rgba(228, 0, 43, 0.12);
}

.block-blue {
  border-color: var(--blue);
  background: rgba(0, 158, 208, 0.12);
}

.block-purple {
  border-color: var(--purple);
  background: rgba(155, 4, 101, 0.12);
}

.block-green {
  border-color: var(--green);
  background: rgba(151, 215, 0, 0.12);
}

.block-orange {
  border-color: var(--orange);
  background: rgba(255, 81, 0, 0.12);
}

.block-yellow {
  border-color: var(--yellow);
  background: rgba(255, 185, 0, 0.12);
}

.block-gold {
  border-color: var(--gold);
  background: rgba(160, 142, 0, 0.12);
}

.block.drag-over {
  border-color: var(--red);
  background: rgba(228,0,43,0.15);
  box-shadow: 0 0 0 3px rgba(228,0,43,0.45);
}

/* ---- Block titles ---- */
.block-title {
  font-size: 1rem;
  font-weight: 700;
  margin-bottom: 6px;
  color: #F5F5F7;
}

.block-subtitle {
  font-size: 0.85rem;
  opacity: 0.8;
  margin-bottom: 10px;
  color: #C7CADB;
}

.placeholder {
  font-size: 0.85rem;
  opacity: 0.6;
  color: #9FA3BD;
}

/* ============================================================
   Mode Selector
   ============================================================ */
#mode-selector {
  display: flex;
  gap: 18px;
  padding: 14px 20px;
  border-bottom: 1px solid #222633;
  background: linear-gradient(90deg, #05060A, #151827);
}

.mode-card {
  flex: 1;
  min-width: 180px;
  text-align: center;
  padding: 22px 16px;
  border-radius: 22px;
  background: #151821;
  border: 1px solid #2D3244;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  cursor: pointer;
  transition: 0.3s cubic-bezier(.16,1,.3,1);
  position: relative;
  overflow: hidden;
  color: #F5F5F7;
}

.mode-card:hover {
  transform: translateY(-6px) scale(1.04);
  box-shadow: 0 12px 28px rgba(0,0,0,0.18);
}

/* Mode icon with gradient text */
.mode-icon {
  font-size: 44px;
  margin-bottom: 14px;
  transition: transform 0.4s ease;
}

.mode-icon img {
  width: 40px;
  height: 40px;
  display: block;
}

.mode-card:hover .mode-icon {
  transform: scale(1.2) rotate(4deg);
}

/* Gradients */
.mode-icon.grade9 {
  background: linear-gradient(135deg, #E4002B 0%, #FF9AA5 100%);
  -webkit-background-clip: text;
  color: transparent;
}

.mode-icon.grade10 {
  background: linear-gradient(135deg, #FF5100 0%, #FFB900 100%);
  -webkit-background-clip: text;
  color: transparent;
}

.mode-icon.ib {
  background: linear-gradient(135deg, #009ED0 0%, #8FE9FF 100%);
  -webkit-background-clip: text;
  color: transparent;
}

.mode-icon.iad {
  background: linear-gradient(135deg, #A08E00 0%, #FFE98A 100%);
  -webkit-background-clip: text;
  color: transparent;
}

.mode-title {
  font-size: 1.15rem;
  font-weight: 800;
}

.mode-subtitle {
  font-size: 0.9rem;
  opacity: 0.75;
}

/* Active state */
.mode-card.active {
  border-color: var(--red);
  transform: scale(1.05);
  background: radial-gradient(circle at top left, rgba(228,0,43,0.3), #151821);
  box-shadow: 0 14px 40px rgba(228,0,43,0.6);
}

/* Ripple click */
.mode-card:active::after {
  content: "";
  position: absolute;
  top: 50%; left: 50%;
  width: 10px; height: 10px;
  background: rgba(228,0,43,0.25);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: ripple 0.6s ease-out forwards;
}
@keyframes ripple {
  from { opacity: 0.4; transform: translate(-50%, -50%) scale(1); }
  to { opacity: 0;   transform: translate(-50%, -50%) scale(22); }
}

#preview-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.preview-panel {
  width: min(900px, 90vw);
  max-height: 80vh;
  background: #151821;
  border-radius: 18px;
  box-shadow: 0 18px 45px rgba(0,0,0,0.7);
  border: 1px solid #2A3040;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.preview-header,
.preview-footer {
  padding: 12px 18px;
  border-bottom: 1px solid #2A3040;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.preview-footer {
  border-top: 1px solid #2A3040;
  border-bottom: none;
  justify-content: flex-end;
}

.preview-title {
  font-size: 1.05rem;
  font-weight: 700;
  color: #F5F5F7;
}

.preview-body {
  padding: 12px 18px 16px;
  overflow-y: auto;
  font-size: 0.9rem;
  color: #E0E3F0;
}

.preview-body h3 {
  margin: 10px 0 6px;
  font-size: 0.95rem;
  color: #F5F5F7;
}

.preview-body p {
  margin: 4px 0;
}

.preview-table {
  width: 100%;
  border-collapse: collapse;
  margin: 6px 0 12px;
  font-size: 0.85rem;
}

.preview-table th,
.preview-table td {
  border: 1px solid #2A3040;
  padding: 4px 6px;
  text-align: left;
}

.preview-table th {
  background: #1F2334;
  color: #F5F5F7;
  font-weight: 600;
}

.preview-tag-empty {
  opacity: 0.6;
  font-style: italic;
}

.preview-button {
  padding: 8px 14px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
}

#preview-close {
  background: transparent;
  color: #D7DAE8;
  border: 1px solid #3A3F55;
}

#preview-export {
  background: var(--red);
  color: #FFFFFF;
}

/* =======================
   PREVIEW ENHANCED STYLES
   ======================= */
.preview-mode-section {
  margin: 10px 0 14px;
  padding: 10px 12px;
  border-radius: 12px;
  background: #191D2A;
  border: 1px solid #2A3040;
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
}

.preview-mode-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}

.preview-mode-title {
  font-size: 0.95rem;
  font-weight: 700;
  color: #F5F5F7;
}

.preview-mode-chip {
  padding: 2px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 500;
  border: 1px solid #3A3F55;
  background: #11131C;
  color: #D7DAE8;
}

.preview-table tbody tr:nth-child(odd) {
  background: #11131C;
}

.preview-table tbody tr:nth-child(even) {
  background: #151821;
}

/* ============================================================
   COURSE TOOLTIP
   ============================================================ */
#card-tooltip {
  position: fixed;
  max-width: 280px;
  background: #11131C;
  border-radius: 10px;
  padding: 10px 12px;
  border: 1px solid #3A3F55;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  font-size: 0.8rem;
  color: #F5F5F7;
  z-index: 1200;
  display: none;
  pointer-events: none;
}

#card-tooltip .tooltip-title {
  font-weight: 700;
  margin-bottom: 4px;
  font-size: 0.85rem;
}

#card-tooltip .tooltip-body p {
  margin: 2px 0;
  line-height: 1.35;
}

/* ============================================================
   Responsive Layout â€“ Tablet & Mobile
   ============================================================ */

/* Tablet and small laptop: stack the three columns vertically */
@media (max-width: 1024px) {
  main {
    display: block;
    min-height: auto;
  }

  #instructions,
  #available,
  #pathway {
    border-right: none;
    border-left: none;
    border-bottom: 1px solid #2A3040;
    padding: 16px 16px 18px;
  }

  #instructions h2,
  #available h2,
  #pathway h2 {
    font-size: 1.1rem;
  }

  #available-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 12px;
  }

  #blocks {
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 14px;
  }

  .block {
    min-height: 130px;
  }

  .preview-panel {
    width: min(900px, 94vw);
    max-height: 82vh;
  }
}

/* Mobile: tighter layout, horizontal scroll for mode selector, single-column grids */
@media (max-width: 700px) {
  body {
    font-size: 14px;
  }

  #mode-selector {
    padding: 10px 12px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    gap: 12px;
  }

  #mode-selector::-webkit-scrollbar {
    height: 6px;
  }

  #mode-selector::-webkit-scrollbar-thumb {
    background: #2D3244;
    border-radius: 3px;
  }

  .mode-card {
    flex: 0 0 210px;
    min-width: 210px;
    padding: 16px 12px;
  }

  .mode-title {
    font-size: 1rem;
  }

  .mode-subtitle {
    font-size: 0.8rem;
  }

  main {
    display: block;
  }

  #instructions,
  #available,
  #pathway {
    padding: 14px 12px 16px;
    border-bottom: 1px solid #2A3040;
  }

  #available-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }

  #blocks {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  #student-info {
    margin-top: 10px;
    margin-bottom: 12px;
    padding: 12px 12px 10px;
  }

  .card {
    padding: 12px;
  }

  .block {
    padding: 12px;
  }

  .preview-panel {
    width: 94vw;
    max-height: 80vh;
  }

  .preview-body {
    padding: 10px 12px 12px;
  }

  .preview-header,
  .preview-footer {
    padding: 8px 12px;
  }

  .preview-title {
    font-size: 0.95rem;
  }
}

/* ============================================================
   Animations
   ============================================================ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

</style>
</head>
<body>

<!-- ============================================================
     Mode Selector (Top Bar)
     ============================================================ -->
<div id="mode-selector">
  <div class="mode-card active" data-mode="grade9">
    <div class="mode-icon grade9">ğŸ’</div>
    <div class="mode-title">Grade 9 Pathway</div>
    <div class="mode-subtitle">ä¹å¹´çº§è·¯å¾„</div>
  </div>

  <div class="mode-card" data-mode="grade10">
    <div class="mode-icon grade10">ğŸ“š</div>
    <div class="mode-title">Grade 10 Pathway</div>
    <div class="mode-subtitle">åå¹´çº§è·¯å¾„</div>
  </div>

  <div class="mode-card" data-mode="ibdp">
    <div class="mode-icon ib">
      <img src="icon-ibdp.png" alt="IBDP icon" />
    </div>
    <div class="mode-title">IB Diploma Preview</div>
    <div class="mode-subtitle">IB è¯¾ç¨‹é¢„è§ˆ</div>
  </div>

  <div class="mode-card" data-mode="iad">
    <div class="mode-icon iad">
      <img src="icon-iad.png" alt="IAD icon" />
    </div>
    <div class="mode-title">IAD Preview</div>
    <div class="mode-subtitle">å›½é™…é«˜çº§æ–‡å‡­é¢„è§ˆ</div>
  </div>
</div>


<!-- ============================================================
     Three-column Layout
     Left: Instructions
     Middle: Available Courses
     Right: Pathway Blocks
     ============================================================ -->
<main>

  <!-- LEFT COLUMN â€” INSTRUCTIONS -->
  <section id="instructions">
    <h2>Instructions / ä½¿ç”¨è¯´æ˜</h2>
    <p>1. Choose a mode (Grade 9, Grade 10, IB, or IAD). / è¯·é€‰æ‹©ä¸€ä¸ªæ¨¡å¼ï¼ˆä¹å¹´çº§ã€åå¹´çº§ã€IB æˆ– IADï¼‰ã€‚</p>
    <p>2. Drag a coloured tile from the middle panel into a block on the right. / å°†ä¸­é—´æ çš„å½©è‰²è¯¾ç¨‹å¡ç‰‡æ‹–åˆ°å³ä¾§çš„æ¨¡å—ä¸­ã€‚</p>
    <p>3. Each block only accepts certain types of courses. / æ¯ä¸ªæ¨¡å—åªèƒ½æ¥æ”¶æŒ‡å®šç±»å‹çš„è¯¾ç¨‹ã€‚</p>
    <p>4. Drag a tile back to remove it. / å°†è¯¾ç¨‹å¡ç‰‡æ‹–å›ä¸­é—´æ å³å¯ç§»é™¤ã€‚</p>
    <p>5. Complete all blocks, then export your plan. / å®Œæˆæ‰€æœ‰æ¨¡å—åå³å¯å¯¼å‡ºæ‚¨çš„è¯¾ç¨‹è§„åˆ’ã€‚</p>


    <div style="margin-top:20px;">
      <button id="export-button" style="
        padding:10px 16px;
        border-radius:10px;
        background:var(--red);
        color:white;
        border:none;
        font-size:0.9rem;
        cursor:pointer;
      ">
        Export My Selections / å¯¼å‡ºæˆ‘çš„é€‰æ‹©ï¼ˆCSVï¼‰
      </button>

      <br><br>

      <button id="reset-button" style="
        padding:10px 16px;
        border-radius:10px;
        background:#EEE;
        color:#444;
        border:1px solid #DDD;
        font-size:0.9rem;
        cursor:pointer;
      ">
        Reset Current Mode / é‡ç½®å½“å‰æ¨¡å¼
      </button>
    </div>
  </section>


  <!-- MIDDLE COLUMN â€” AVAILABLE COURSES (GRID) -->
  <section id="available">
    <h2 id="available-title">Available Courses / å¯é€‰è¯¾ç¨‹</h2>
    <div id="student-info">
      <h3>Student Information / å­¦ç”Ÿä¿¡æ¯</h3>

      <label for="student-ename">
        English Name / è‹±æ–‡å§“å
        <br />
        <input
          id="student-ename"
          type="text"
          style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #DDD;margin-top:4px;"
        />
      </label>
      <br /><br />

      <label for="student-cname">
        Chinese Name / ä¸­æ–‡å§“å
        <br />
        <input
          id="student-cname"
          type="text"
          style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #DDD;margin-top:4px;"
        />
      </label>
      <br /><br />

      <label for="student-grade">
        Current Grade / å½“å‰å¹´çº§
        <br />
        <input
          id="student-grade"
          type="text"
          placeholder="e.g. G8, G9"
          style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #DDD;margin-top:4px;"
        />
      </label>
      <br /><br />

      <label for="student-existing">
        Existing Dehong Student? / æ˜¯å¦ä¸ºåœ¨è¯»å¾·é—³å­¦ç”Ÿï¼Ÿ
        <br />
        <select
          id="student-existing"
          style="width:100%;padding:6px 8px;border-radius:8px;border:1px solid #DDD;margin-top:4px;"
        >
          <option value="">-- Please select / è¯·é€‰æ‹© --</option>
          <option value="Yes">Yes / æ˜¯</option>
          <option value="No">No / å¦</option>
        </select>
      </label>
    </div>
    <div id="available-grid">
      <!-- JS will dynamically inject cards for Grade 9 / IB / IAD -->
    </div>
  </section>


  <!-- RIGHT COLUMN â€” PATHWAY BLOCKS -->
  <section id="pathway">
    <h2 id="pathway-title">My Grade 9 Pathway / æˆ‘çš„ä¹å¹´çº§å­¦ä¹ è·¯å¾„</h2>
    <div id="blocks">
      <!-- JS will dynamically inject Grade 9 / IB / IAD blocks -->
    </div>
  </section>

<!-- ============================================================
     Preview Overlay
     ============================================================ -->
<div id="preview-overlay">
  <div class="preview-panel">
    <div class="preview-header">
      <div class="preview-title">Preview My Plan / é¢„è§ˆæˆ‘çš„è¯¾ç¨‹è§„åˆ’</div>
      <button id="preview-close" class="preview-button">
        Close / è¿”å›
      </button>
    </div>
    <div id="preview-body" class="preview-body">
      <!-- JS will populate preview content -->
    </div>
    <div class="preview-footer">
      <button id="preview-export" class="preview-button">
        Confirm Export (CSV) / ç¡®è®¤å¯¼å‡ºï¼ˆCSVï¼‰
      </button>
    </div>
  </div>
</div>

</main>

</body>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
/* ============================================================================
   Core JavaScript Logic
   ============================================================================ */

/* ============================================================
   Mode definitions
   ============================================================ */
let currentMode = "grade9";

const savedSelections = {
  grade9: {},
  grade10: {},
  ibdp: {},
  iad: {}
};

/* ============================================================
   Course data by mode
   ============================================================ */

const grade9Cards = [
  {
    id:"g9_chi_ll",
    title_en:"Chinese Language & Literature",
    title_zh:"ä¸­æ–‡è¯­è¨€ä¸æ–‡å­¦",
    category:"g9_chinese",
    color:"red",
    desc_en:"Builds accurate reading, writing and speaking in Chinese through modern and classical texts, preparing students for advanced bilingual study.",
    desc_zh:"é€šè¿‡å­¦ä¹ ç°ä»£ä¸ç»å…¸æ–‡æœ¬ï¼Œæé«˜å­¦ç”Ÿçš„ä¸­æ–‡é˜…è¯»ã€å†™ä½œä¸å£è¯­è¡¨è¾¾èƒ½åŠ›ï¼Œä¸ºåç»­æ›´é«˜é˜¶æ®µçš„åŒè¯­å­¦ä¹ æ‰“ä¸‹åŸºç¡€ã€‚"
  },
  {
    id:"g9_engA",
    title_en:"English A: Lang & Lit",
    title_zh:"è‹±è¯­Aï¼šè¯­è¨€ä¸æ–‡å­¦",
    category:"g9_english",
    color:"blue",
    desc_en:"Introduces IB-style language and literature skills, analysing fiction and non-fiction while building strong academic English writing and discussion.",
    desc_zh:"ä»¥IBé£æ ¼çš„è¯­è¨€ä¸æ–‡å­¦å­¦ä¹ ä¸ºå¯¼å‘ï¼Œé€šè¿‡åˆ†ææ–‡å­¦ä¸éæ–‡å­¦æ–‡æœ¬ï¼Œæå‡å­¦ç”Ÿçš„è‹±è¯­å­¦æœ¯å†™ä½œä¸è¯¾å ‚è®¨è®ºèƒ½åŠ›ã€‚"
  },
  {
    id:"g9_engB",
    title_en:"English B (Acquisition)",
    title_zh:"è‹±è¯­Bï¼šè¯­è¨€ä¹ å¾—",
    category:"g9_english",
    color:"blue",
    desc_en:"Strengthens core grammar, vocabulary and communication for learners who need more support in everyday and academic English.",
    desc_zh:"ä¸ºéœ€è¦æ›´å¤šè¯­è¨€æ”¯æŒçš„å­¦ç”Ÿå¤¯å®è¯­æ³•å’Œè¯æ±‡åŸºç¡€ï¼Œæå‡åœ¨æ—¥å¸¸ä¸å­¦æœ¯æƒ…å¢ƒä¸­çš„è‹±è¯­æ²Ÿé€šèƒ½åŠ›ã€‚"
  },
  {
    id:"g9_eng_enh",
    title_en:"Enhanced English",
    title_zh:"è‹±è¯­å¼ºåŒ–",
    category:"g9_english",
    color:"blue",
    desc_en:"Provides extra challenge in reading, writing and speaking to stretch confident English users towards higher-level pathways.",
    desc_zh:"ä¸ºè‹±è¯­åŸºç¡€è¾ƒå¥½çš„å­¦ç”Ÿæä¾›æ›´å…·æŒ‘æˆ˜æ€§çš„é˜…è¯»ã€å†™ä½œä¸å£è¯­è®­ç»ƒï¼Œå¸®åŠ©ä»–ä»¬è¡”æ¥æ›´é«˜é˜¶çš„å­¦ä¹ è·¯å¾„ã€‚"
  },

  {
    id:"g9_math_h",
    title_en:"Mathematics Higher",
    title_zh:"é«˜é˜¶æ•°å­¦",
    category:"g9_math",
    color:"purple",
    desc_en:"Explores algebra, functions and problem-solving in greater depth, preparing students for advanced mathematics options.",
    desc_zh:"åœ¨ä»£æ•°ã€å‡½æ•°ä¸é—®é¢˜è§£å†³ç­‰æ–¹é¢è¿›è¡Œæ›´æ·±å…¥çš„å­¦ä¹ ï¼Œä¸ºåç»­é€‰æ‹©é«˜é˜¶æ•°å­¦è¯¾ç¨‹åšå¥½å‡†å¤‡ã€‚"
  },
  {
    id:"g9_math_s",
    title_en:"Mathematics Standard",
    title_zh:"æ ‡å‡†æ•°å­¦",
    category:"g9_math",
    color:"purple",
    desc_en:"Consolidates key number, algebra and graphing skills needed for science, business and humanities pathways.",
    desc_zh:"å·©å›ºæ•°ä¸ä»£æ•°ã€å›¾åƒç­‰æ ¸å¿ƒæ•°å­¦æŠ€èƒ½ï¼Œæ”¯æŒæœªæ¥åœ¨ç§‘å­¦ã€å•†ç§‘ä¸äººæ–‡å­¦ç§‘ç­‰ä¸åŒè·¯å¾„çš„å‘å±•ã€‚"
  },

  {
    id:"g9_phys",
    title_en:"Physics",
    title_zh:"ç‰©ç†",
    category:"g9_science_p",
    color:"green",
    desc_en:"Introduces motion, forces, energy and waves, building experimental and analytical skills for further physics study.",
    desc_zh:"é€šè¿‡å­¦ä¹ è¿åŠ¨ã€åŠ›ã€èƒ½é‡ä¸æ³¢ç­‰ä¸»é¢˜ï¼ŒåŸ¹å…»å­¦ç”Ÿçš„å®éªŒæ¢ç©¶ä¸æ•°æ®åˆ†æèƒ½åŠ›ï¼Œä¸ºåç»­ç‰©ç†å­¦ä¹ å¥ å®šåŸºç¡€ã€‚"
  },
  {
    id:"g9_bio",
    title_en:"Biology",
    title_zh:"ç”Ÿç‰©",
    category:"g9_science_p",
    color:"green",
    desc_en:"Explores cells, body systems and ecosystems, helping students understand living organisms from micro to macro level.",
    desc_zh:"ä»ç»†èƒã€äººä½“ç³»ç»Ÿåˆ°ç”Ÿæ€ç³»ç»Ÿå¤šä¸ªå±‚é¢ï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£ç”Ÿå‘½ç°è±¡ä¸ç”Ÿå‘½ç³»ç»Ÿçš„åŸºæœ¬åŸç†ã€‚"
  },

  {
    id:"g9_chem",
    title_en:"Chemistry",
    title_zh:"åŒ–å­¦",
    category:"g9_science_s",
    color:"orange",
    desc_en:"Covers particles, reactions and the periodic table while developing practical skills in planning and evaluating experiments.",
    desc_zh:"å­¦ä¹ å¾®ç²’ã€åŒ–å­¦ååº”ä¸å…ƒç´ å‘¨æœŸè¡¨ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶å‘å±•è®¾è®¡å®éªŒä¸è¯„ä¼°ç»“æœçš„å®è·µèƒ½åŠ›ã€‚"
  },
  {
    id:"g9_health",
    title_en:"Health Science",
    title_zh:"å¥åº·ç§‘å­¦",
    category:"g9_science_s",
    color:"orange",
    desc_en:"Connects biology with real-life health topics such as lifestyle, disease prevention and wellbeing.",
    desc_zh:"å°†ç”Ÿç‰©å­¦çŸ¥è¯†ä¸ç”Ÿæ´»ä¸­çš„å¥åº·è®®é¢˜ç›¸è”ç³»ï¼Œå…³æ³¨ç”Ÿæ´»æ–¹å¼ã€ç–¾ç—…é¢„é˜²ä¸èº«å¿ƒå¥åº·ã€‚"
  },

  {
    id:"g9_music",
    title_en:"Music",
    title_zh:"éŸ³ä¹",
    category:"g9_arts_hum",
    color:"yellow",
    desc_en:"Develops listening, performance and basic composition skills across different musical styles and cultures.",
    desc_zh:"é€šè¿‡æ¬£èµã€è¡¨æ¼”ä¸åŸºç¡€åˆ›ä½œï¼Œä½“éªŒä¸åŒé£æ ¼ä¸æ–‡åŒ–çš„éŸ³ä¹ï¼Œæå‡éŸ³ä¹ç´ å…»ä¸è¡¨ç°åŠ›ã€‚"
  },
  {
    id:"g9_gp",
    title_en:"Global Perspectives",
    title_zh:"å…¨çƒè§†é‡",
    category:"g9_arts_hum",
    color:"yellow",
    desc_en:"Encourages critical thinking about global issues, helping students research, collaborate and communicate informed viewpoints.",
    desc_zh:"å›´ç»•å…¨çƒæ€§è®®é¢˜åŸ¹å…»æ‰¹åˆ¤æ€§æ€ç»´ï¼Œå¼•å¯¼å­¦ç”Ÿå¼€å±•æ¢ç©¶ã€åˆä½œå¹¶è¡¨è¾¾æœ‰ä¾æ®çš„è§‚ç‚¹ã€‚"
  },

  {
    id:"g9_art",
    title_en:"Art",
    title_zh:"è‰ºæœ¯",
    category:"g9_arts_des",
    color:"yellow",
    desc_en:"Explores drawing, painting and mixed media, building confidence in visual expression and creative thinking.",
    desc_zh:"é€šè¿‡ç´ æã€ç»˜ç”»ä¸ç»¼åˆææ–™åˆ›ä½œï¼ŒåŸ¹å…»å­¦ç”Ÿçš„è§†è§‰è¡¨è¾¾èƒ½åŠ›ä¸åˆ›é€ æ€§æ€ç»´ã€‚"
  },
  {
    id:"g9_design",
    title_en:"Design Thinking",
    title_zh:"è®¾è®¡æ€ç»´",
    category:"g9_arts_des",
    color:"yellow",
    desc_en:"Uses a human-centred design cycle to solve real problems, combining creativity, prototyping and reflection.",
    desc_zh:"ä»¥ä»¥äººä¸ºæœ¬çš„è®¾è®¡æµç¨‹è§£å†³çœŸå®é—®é¢˜ï¼Œèåˆåˆ›æ„æ„æ€ã€åŸå‹åˆ¶ä½œä¸åæ€æ”¹è¿›ã€‚"
  },

  {
    id:"g9_slead",
    title_en:"Sports Leadership",
    title_zh:"ä½“è‚²é¢†å¯¼åŠ›",
    category:"g9_personal",
    color:"gold",
    desc_en:"Builds leadership through coaching, teamwork and event roles in sport and physical wellbeing contexts.",
    desc_zh:"åœ¨ä½“è‚²ä¸èº«å¿ƒå¥åº·æ´»åŠ¨ä¸­ï¼Œé€šè¿‡å¸¦é˜Ÿã€åä½œä¸ç»„ç»‡å®è·µæå‡å­¦ç”Ÿçš„é¢†å¯¼åŠ›ä¸è´£ä»»æ„Ÿã€‚"
  },
  {
    id:"g9_envlead",
    title_en:"Environmental Leadership",
    title_zh:"ç¯å¢ƒé¢†å¯¼åŠ›",
    category:"g9_personal",
    color:"gold",
    desc_en:"Focuses on sustainability projects and advocacy, helping students lead positive change for the environment.",
    desc_zh:"å›´ç»•å¯æŒç»­å‘å±•é¡¹ç›®ä¸å€¡å¯¼è¡ŒåŠ¨ï¼ŒåŸ¹å…»å­¦ç”Ÿåœ¨ç¯å¢ƒä¿æŠ¤æ–¹é¢çš„è¡ŒåŠ¨åŠ›ä¸é¢†å¯¼åŠ›ã€‚"
  },
  {
    id:"g9_stemlead",
    title_en:"STEM Leadership",
    title_zh:"STEMé¢†å¯¼åŠ›",
    category:"g9_personal",
    color:"gold",
    desc_en:"Combines science, technology and problem-solving challenges to develop innovation and collaborative project skills.",
    desc_zh:"é€šè¿‡ç§‘å­¦ä¸æŠ€æœ¯ç›¸å…³çš„æŒ‘æˆ˜ä¸é¡¹ç›®ï¼Œå‘å±•å­¦ç”Ÿçš„åˆ›æ–°èƒ½åŠ›ä¸å›¢é˜Ÿé¡¹ç›®ç®¡ç†èƒ½åŠ›ã€‚"
  }
];

const grade10Cards = [
  {
    id:"g10_chi_ll",
    title_en:"Chinese Language & Literature",
    title_zh:"ä¸­æ–‡è¯­è¨€ä¸æ–‡å­¦",
    category:"g10_chinese",
    color:"red",
    desc_en:"Deepens analytical reading and writing in Chinese through a wider range of literary and non-literary texts, preparing students for upper-secondary Chinese pathways.",
    desc_zh:"é€šè¿‡æ›´å¹¿æ³›çš„æ–‡å­¦ä¸éæ–‡å­¦æ–‡æœ¬è®­ç»ƒä¸­æ–‡é˜…è¯»ä¸å†™ä½œåˆ†æèƒ½åŠ›ï¼Œä¸ºåç»­é«˜ä¸­é˜¶æ®µçš„ä¸­æ–‡å­¦ä¹ åšå¥½è¡”æ¥ã€‚"
  },
  {
    id:"g10_eng_ll",
    title_en:"English Language & Literature",
    title_zh:"è‹±è¯­è¯­è¨€ä¸æ–‡å­¦",
    category:"g10_english",
    color:"blue",
    desc_en:"Develops close reading, textual analysis and academic writing in English, building strong foundations for IB or IAD English courses.",
    desc_zh:"é€šè¿‡ç²¾è¯»ã€æ–‡æœ¬åˆ†æä¸å­¦æœ¯å†™ä½œè®­ç»ƒï¼Œç³»ç»Ÿæå‡å­¦ç”Ÿçš„è‹±è¯­è¯­è¨€ä¸æ–‡å­¦èƒ½åŠ›ï¼Œä¸ºIBæˆ–IADé˜¶æ®µçš„è‹±è¯­è¯¾ç¨‹æ‰“ä¸‹åŸºç¡€ã€‚"
  },
  {
    id:"g10_eng_enh",
    title_en:"Enhanced English",
    title_zh:"è‹±è¯­å¼ºåŒ–",
    category:"g10_english",
    color:"blue",
    desc_en:"Provides additional challenge in vocabulary, structure and extended writing for students aiming for higher-level English pathways.",
    desc_zh:"åœ¨è¯æ±‡ã€è¯­æ³•ç»“æ„ä¸é•¿ç¯‡å†™ä½œæ–¹é¢æä¾›æ›´é«˜æŒ‘æˆ˜ï¼Œé€‚åˆå¸Œæœ›åœ¨é«˜ä¸­é˜¶æ®µé€‰æ‹©æ›´é«˜é˜¶è‹±è¯­è·¯å¾„çš„å­¦ç”Ÿã€‚"
  },

  {
    id:"g10_math_core",
    title_en:"Core Mathematics",
    title_zh:"æ ¸å¿ƒæ•°å­¦",
    category:"g10_math",
    color:"purple",
    desc_en:"Consolidates key algebra, geometry and data skills needed for a wide range of IB and IAD subjects.",
    desc_zh:"å·©å›ºä»£æ•°ã€å‡ ä½•ä¸æ•°æ®å¤„ç†ç­‰æ ¸å¿ƒæŠ€èƒ½ï¼Œä¸ºå¤šç§IBä¸IADç§‘ç›®æä¾›æ•°å­¦æ”¯æ’‘ã€‚"
  },
  {
    id:"g10_math_ext",
    title_en:"Extended Mathematics",
    title_zh:"æ‰©å±•æ•°å­¦",
    category:"g10_math",
    color:"purple",
    desc_en:"Extends core content with more demanding algebra, functions and problem-solving for students considering higher-level mathematics.",
    desc_zh:"åœ¨æ ¸å¿ƒå†…å®¹åŸºç¡€ä¸Šå¢åŠ æ›´å…·éš¾åº¦çš„ä»£æ•°ã€å‡½æ•°ä¸é—®é¢˜è§£å†³ç»ƒä¹ ï¼Œé€‚åˆæœªæ¥è€ƒè™‘é«˜é˜¶æ•°å­¦è¯¾ç¨‹çš„å­¦ç”Ÿã€‚"
  },

  {
    id:"g10_sci_phys",
    title_en:"Physics",
    title_zh:"ç‰©ç†",
    category:"g10_science",
    color:"green",
    desc_en:"Continues the study of motion, forces, energy and electricity with a stronger focus on experimental design and data analysis.",
    desc_zh:"åœ¨è¿åŠ¨ã€åŠ›ã€èƒ½é‡ä¸ç”µå­¦ç­‰ä¸»é¢˜ä¸Šè¿›ä¸€æ­¥æ·±å…¥å­¦ä¹ ï¼Œæ›´æ³¨é‡å®éªŒè®¾è®¡ä¸æ•°æ®åˆ†æèƒ½åŠ›çš„åŸ¹å…»ã€‚"
  },
  {
    id:"g10_sci_chem",
    title_en:"Chemistry",
    title_zh:"åŒ–å­¦",
    category:"g10_science",
    color:"orange",
    desc_en:"Builds understanding of structure, bonding and chemical change while practising safe, accurate laboratory work.",
    desc_zh:"å›´ç»•ç‰©è´¨ç»“æ„ã€åŒ–å­¦é”®ä¸åŒ–å­¦å˜åŒ–ç­‰æ ¸å¿ƒæ¦‚å¿µå±•å¼€å­¦ä¹ ï¼Œå¹¶é€šè¿‡å®éªŒæ“ä½œåŠ å¼ºå®‰å…¨è§„èŒƒä¸æ•°æ®å‡†ç¡®æ€§ã€‚"
  },
  {
    id:"g10_sci_bio",
    title_en:"Biology",
    title_zh:"ç”Ÿç‰©",
    category:"g10_science",
    color:"green",
    desc_en:"Explores genetics, homeostasis and ecology, strengthening scientific writing and practical skills for further biology study.",
    desc_zh:"å­¦ä¹ é—ä¼ ã€å†…ç¯å¢ƒç¨³å®šä¸ç”Ÿæ€å­¦ç­‰ä¸»é¢˜ï¼Œæå‡ç§‘å­¦å†™ä½œä¸å®éªŒå®è·µèƒ½åŠ›ï¼Œä¸ºåç»­ç”Ÿç‰©è¯¾ç¨‹æ‰“å¥½åŸºç¡€ã€‚"
  },

  {
    id:"g10_hum_hist",
    title_en:"History",
    title_zh:"å†å²",
    category:"g10_hum",
    color:"yellow",
    desc_en:"Uses case studies from different periods to build source evaluation, essay planning and critical thinking skills.",
    desc_zh:"é€šè¿‡ä¸åŒæ—¶æœŸçš„å†å²æ¡ˆä¾‹è®­ç»ƒå­¦ç”Ÿè§£è¯»å²æ–™ã€ç»„ç»‡è®ºè¯ä¸æ‰¹åˆ¤æ€§æ€ç»´èƒ½åŠ›ã€‚"
  },
  {
    id:"g10_hum_geo",
    title_en:"Geography",
    title_zh:"åœ°ç†",
    category:"g10_hum",
    color:"yellow",
    desc_en:"Examines peopleâ€“environment interactions, urbanisation and development, connecting map skills with real-world issues.",
    desc_zh:"å›´ç»•äººåœ°å…³ç³»ã€åŸå¸‚åŒ–ä¸å‘å±•ç­‰è®®é¢˜å±•å¼€å­¦ä¹ ï¼Œå°†åœ°å›¾æŠ€èƒ½ä¸çœŸå®ä¸–ç•Œé—®é¢˜ç´§å¯†ç»“åˆã€‚"
  },

  {
    id:"g10_art",
    title_en:"Art & Design",
    title_zh:"è‰ºæœ¯ä¸è®¾è®¡",
    category:"g10_art",
    color:"yellow",
    desc_en:"Develops a personal portfolio through drawing, mixed media and design projects, encouraging experimentation and reflection.",
    desc_zh:"é€šè¿‡ç»˜ç”»ã€ç»¼åˆææ–™ä¸è®¾è®¡é¡¹ç›®åˆ›ä½œä¸ªäººä½œå“é›†ï¼Œé¼“åŠ±å­¦ç”Ÿå‹‡äºå°è¯•å¹¶è¿›è¡Œè‡ªæˆ‘åæ€ã€‚"
  },
  {
    id:"g10_music",
    title_en:"Music",
    title_zh:"éŸ³ä¹",
    category:"g10_art",
    color:"yellow",
    desc_en:"Combines performance, listening and basic composition to deepen musical understanding across genres.",
    desc_zh:"åœ¨è¡¨æ¼”ã€æ¬£èµä¸åŸºç¡€åˆ›ä½œä¸­ä½“éªŒå¤šç§é£æ ¼éŸ³ä¹ï¼ŒåŠ æ·±å¯¹éŸ³ä¹ç»“æ„ä¸è¡¨è¾¾æ–¹å¼çš„ç†è§£ã€‚"
  },

  {
    id:"g10_pe",
    title_en:"Sport & Wellbeing",
    title_zh:"ä½“è‚²ä¸èº«å¿ƒå¥åº·",
    category:"g10_core",
    color:"gold",
    desc_en:"Promotes physical fitness, teamwork and healthy habits through a range of individual and team activities.",
    desc_zh:"é€šè¿‡å¤šç§ä¸ªäººä¸å›¢é˜Ÿè¿åŠ¨ä¿ƒè¿›ä½“èƒ½å‘å±•ã€å›¢é˜Ÿåˆä½œä¸å¥åº·ç”Ÿæ´»ä¹ æƒ¯çš„å…»æˆã€‚"
  },
  {
    id:"g10_qidi",
    title_en:"Qidi / Signature Course",
    title_zh:"å¯è¿ªè¯¾ / ç‰¹è‰²è¯¾ç¨‹",
    category:"g10_core",
    color:"gold",
    desc_en:"Offers an interdisciplinary, project-based experience that connects real-world questions with future pathways.",
    desc_zh:"ä»¥è·¨å­¦ç§‘ã€é¡¹ç›®å¼å­¦ä¹ ä¸ºç‰¹è‰²ï¼Œå°†çœŸå®ä¸–ç•Œé—®é¢˜ä¸æœªæ¥å­¦ä¹ ä¸å‘å±•è·¯å¾„ç›¸è¿æ¥ã€‚"
  }
];

const ibdpCards = [
  {
    id:"ib_langA_eng",
    title_en:"English A: Lang & Lit HL",
    title_zh:"è‹±è¯­A è¯­è¨€ä¸æ–‡å­¦ é«˜æ°´",
    category:"ib_langA",
    color:"red",
    desc_en:"Develops advanced literary and language analysis in English through a wide range of texts, preparing students for essay-based study at university.",
    desc_zh:"é€šè¿‡ç ”è¯»å¤šç§ä½“è£çš„è‹±è¯­æ–‡æœ¬ï¼Œç³»ç»Ÿè®­ç»ƒæ–‡å­¦ä¸è¯­è¨€åˆ†æèƒ½åŠ›ï¼Œä¸ºå¤§å­¦é˜¶æ®µä»¥è®ºæ–‡ä¸ºä¸»çš„å­¦ä¹ åšå¥½å‡†å¤‡ã€‚"
  },
  {
    id:"ib_langA_chi",
    title_en:"Chinese A HL",
    title_zh:"ä¸­æ–‡A é«˜æ°´",
    category:"ib_langA",
    color:"red",
    desc_en:"Strengthens critical reading and refined writing in Chinese, focusing on how authors use language to shape ideas, culture and identity.",
    desc_zh:"åœ¨æ·±å…¥é˜…è¯»ä¸­æ–‡ä½œå“çš„åŸºç¡€ä¸Šï¼Œæå‡æ‰¹åˆ¤æ€§é˜…è¯»ä¸é«˜çº§å†™ä½œèƒ½åŠ›ï¼Œå…³æ³¨ä½œè€…å¦‚ä½•é€šè¿‡è¯­è¨€å‘ˆç°æ€æƒ³ã€æ–‡åŒ–ä¸èº«ä»½ã€‚"
  },

  {
    id:"ib_langB_eng",
    title_en:"English B HL",
    title_zh:"è‹±è¯­B é«˜æ°´",
    category:"ib_langB",
    color:"blue",
    desc_en:"Builds high-level communicative and academic English for students who learn English as an additional language, with an emphasis on global topics.",
    desc_zh:"ä¸ºå°†è‹±è¯­ä½œä¸ºç¬¬äºŒè¯­è¨€çš„å­¦ç”Ÿæå‡é«˜é˜¶æ²Ÿé€šä¸å­¦æœ¯è‹±è¯­èƒ½åŠ›ï¼Œå›´ç»•å¤šå…ƒå…¨çƒè®®é¢˜è¿›è¡Œè¯­è¨€è¿ç”¨ä¸è¡¨è¾¾ã€‚"
  },
  {
    id:"ib_langB_chi",
    title_en:"Chinese B SL",
    title_zh:"ä¸­æ–‡B æ ‡æ°´",
    category:"ib_langB",
    color:"blue",
    desc_en:"Consolidates Chinese language skills for learners who are not native speakers, focusing on real-life situations and intercultural understanding.",
    desc_zh:"é¢å‘éæ¯è¯­å­¦ä¹ è€…ï¼Œå·©å›ºä¸­æ–‡å¬è¯´è¯»å†™èƒ½åŠ›ï¼Œå¼ºè°ƒçœŸå®æƒ…å¢ƒä¸‹çš„äº¤æµä¸è·¨æ–‡åŒ–ç†è§£ã€‚"
  },

  {
    id:"ib_econ",
    title_en:"Economics HL",
    title_zh:"ç»æµå­¦ é«˜æ°´",
    category:"ib_soc",
    color:"yellow",
    desc_en:"Explores micro, macro and global economics, helping students apply economic concepts to real policy questions and everyday decisions.",
    desc_zh:"ä»å¾®è§‚ã€å®è§‚ä¸å…¨çƒè§†è§’æ¢è®¨ç»æµå­¦æ¦‚å¿µï¼Œå¼•å¯¼å­¦ç”Ÿå°†ç†è®ºåº”ç”¨äºå®é™…æ”¿ç­–é—®é¢˜ä¸ç”Ÿæ´»å†³ç­–ã€‚"
  },
  {
    id:"ib_psych",
    title_en:"Psychology SL",
    title_zh:"å¿ƒç†å­¦ æ ‡æ°´",
    category:"ib_soc",
    color:"yellow",
    desc_en:"Introduces key psychological theories and research methods to explain how thinking, behaviour and emotions are shaped.",
    desc_zh:"ä»‹ç»æ ¸å¿ƒå¿ƒç†å­¦ç†è®ºä¸ç ”ç©¶æ–¹æ³•ï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£äººç±»æ€ç»´ã€è¡Œä¸ºä¸æƒ…ç»ªå½¢æˆçš„åŸå› ã€‚"
  },

  {
    id:"ib_bio",
    title_en:"Biology HL",
    title_zh:"ç”Ÿç‰© é«˜æ°´",
    category:"ib_sci",
    color:"green",
    desc_en:"Studies living systems from cells to ecosystems with a strong focus on practical work, data analysis and scientific writing.",
    desc_zh:"ä»ç»†èƒåˆ°ç”Ÿæ€ç³»ç»Ÿå¤šä¸ªå±‚é¢ç ”ç©¶ç”Ÿå‘½ç³»ç»Ÿï¼Œå¼ºè°ƒå®éªŒå®è·µã€æ•°æ®åˆ†æä¸ç§‘å­¦å†™ä½œèƒ½åŠ›ã€‚"
  },
  {
    id:"ib_phys",
    title_en:"Physics HL",
    title_zh:"ç‰©ç† é«˜æ°´",
    category:"ib_sci",
    color:"green",
    desc_en:"Covers mechanics, energy, fields and modern physics, developing strong mathematical modelling and problem-solving skills.",
    desc_zh:"å­¦ä¹ åŠ›å­¦ã€èƒ½é‡ã€åœºä¸è¿‘ä»£ç‰©ç†ç­‰å†…å®¹ï¼ŒåŸ¹å…»æ‰å®çš„æ•°å­¦å»ºæ¨¡ä¸ç‰©ç†é—®é¢˜è§£å†³èƒ½åŠ›ã€‚"
  },

  {
    id:"ib_math_aa",
    title_en:"Math AA HL",
    title_zh:"æ•°å­¦AA é«˜æ°´",
    category:"ib_math",
    color:"purple",
    desc_en:"Focuses on pure mathematics and rigorous problem solving, ideal for students considering mathematically intensive university courses.",
    desc_zh:"å¼ºè°ƒçº¯æ•°å­¦å†…å®¹ä¸ä¸¥è°¨çš„è§£é¢˜è¿‡ç¨‹ï¼Œé€‚åˆæœªæ¥è®¡åˆ’æ”»è¯»æ•°å­¦å¯†é›†å‹å¤§å­¦ä¸“ä¸šçš„å­¦ç”Ÿã€‚"
  },
  {
    id:"ib_math_ai",
    title_en:"Math AI SL",
    title_zh:"æ•°å­¦AI æ ‡æ°´",
    category:"ib_math",
    color:"purple",
    desc_en:"Applies mathematics to real data and everyday contexts, supporting pathways in social sciences, business and interdisciplinary fields.",
    desc_zh:"ä¾§é‡å°†æ•°å­¦åº”ç”¨äºçœŸå®æ•°æ®ä¸ç”Ÿæ´»æƒ…å¢ƒï¼Œæ”¯æŒæœªæ¥åœ¨ç¤¾ä¼šç§‘å­¦ã€å•†ç§‘ä¸è·¨å­¦ç§‘é¢†åŸŸçš„å‘å±•ã€‚"
  },

  {
    id:"ib_va",
    title_en:"Visual Arts SL",
    title_zh:"è§†è§‰è‰ºæœ¯ æ ‡æ°´",
    category:"ib_elec",
    color:"orange",
    desc_en:"Encourages personal artistic inquiry through studio work and a process portfolio, connecting practical skills with critical reflection.",
    desc_zh:"é€šè¿‡åˆ›ä½œå®è·µä¸è¿‡ç¨‹ä½œå“é›†é¼“åŠ±å­¦ç”Ÿå¼€å±•ä¸ªäººè‰ºæœ¯æ¢ç©¶ï¼Œå°†æŠ€æ³•è®­ç»ƒä¸æ‰¹åˆ¤æ€§åæ€ç›¸ç»“åˆã€‚"
  },
  {
    id:"ib_second",
    title_en:"Second Science / SocSci",
    title_zh:"ç¬¬äºŒé—¨ç§‘å­¦æˆ–ç¤¾ç§‘",
    category:"ib_elec",
    color:"orange",
    desc_en:"Allows students to deepen either a second experimental science or another individuals-and-societies subject to balance their IB profile.",
    desc_zh:"ä¸ºå­¦ç”Ÿæä¾›é€‰æ‹©ç¬¬äºŒé—¨å®éªŒç§‘å­¦æˆ–å¦ä¸€é—¨ä¸ªä½“ä¸ç¤¾ä¼šå­¦ç§‘çš„æœºä¼šï¼Œä½¿æ•´ä½“IBè¯¾ç¨‹ç»„åˆæ›´åŠ å‡è¡¡ã€‚"
  }
];

const iadCards = [
  {
    id:"iad_eng",
    title_en:"Cambridge English",
    title_zh:"å‰‘æ¡¥è‹±è¯­",
    category:"iad_1",
    color:"blue",
    desc_en:"Develops advanced reading, writing, listening and speaking skills in English with a focus on academic accuracy and examination techniques.",
    desc_zh:"é€šè¿‡ç³»ç»Ÿè®­ç»ƒè‹±è¯­å¬ã€è¯´ã€è¯»ã€å†™èƒ½åŠ›ï¼Œå¼ºåŒ–å­¦æœ¯è¡¨è¾¾ä¸è€ƒè¯•æŠ€å·§ï¼Œä¸ºåç»­å¤§å­¦ç”³è¯·åšå¥½è¯­è¨€å‡†å¤‡ã€‚"
  },
  {
    id:"iad_chi",
    title_en:"Chinese A-Level",
    title_zh:"ä¸­æ–‡A-Level",
    category:"iad_1",
    color:"red",
    desc_en:"Builds high-level Chinese language, literature and cultural understanding, supporting students who wish to keep strong links to Chinese studies.",
    desc_zh:"åœ¨è¯­è¨€ã€æ–‡å­¦ä¸æ–‡åŒ–ä¸‰ä¸ªå±‚é¢æ·±åŒ–ä¸­æ–‡èƒ½åŠ›ï¼Œé€‚åˆå¸Œæœ›ä¿æŒå¹¶å‘å±•æ‰å®ä¸­æ–‡ç´ å…»çš„å­¦ç”Ÿã€‚"
  },
  {
    id:"iad_epq",
    title_en:"EPQ Project",
    title_zh:"EPQé¡¹ç›®",
    category:"iad_1",
    color:"gold",
    desc_en:"Offers an extended independent research project where students design a question, carry out research and present their findings in depth.",
    desc_zh:"é€šè¿‡è‡ªä¸»ç¡®å®šç ”ç©¶é—®é¢˜ã€æ”¶é›†èµ„æ–™ä¸æ’°å†™æŠ¥å‘Šï¼ŒåŸ¹å…»å­¦ç”Ÿçš„ç‹¬ç«‹ç ”ç©¶èƒ½åŠ›ä¸å­¦æœ¯è¡¨è¾¾èƒ½åŠ›ã€‚"
  },

  {
    id:"iad_bus",
    title_en:"Business",
    title_zh:"å•†ä¸š",
    category:"iad_2",
    color:"yellow",
    desc_en:"Introduces core concepts such as marketing, finance, operations and people management, linking theory to real business cases.",
    desc_zh:"å›´ç»•å¸‚åœºè¥é”€ã€è´¢åŠ¡ã€è¿è¥ä¸äººå‘˜ç®¡ç†ç­‰æ ¸å¿ƒæ¦‚å¿µå±•å¼€å­¦ä¹ ï¼Œå¹¶ç»“åˆçœŸå®å•†ä¸šæ¡ˆä¾‹ç†è§£ç†è®ºçš„å®é™…åº”ç”¨ã€‚"
  },
  {
    id:"iad_bio",
    title_en:"Biology",
    title_zh:"ç”Ÿç‰©",
    category:"iad_2",
    color:"green",
    desc_en:"Explores cell biology, physiology, genetics and ecology while strengthening experimental design and scientific writing.",
    desc_zh:"å­¦ä¹ ç»†èƒã€ç”Ÿç†ã€é—ä¼ ä¸ç”Ÿæ€ç­‰ä¸»é¢˜ï¼Œå¹¶é€šè¿‡å®éªŒè®¾è®¡ä¸ç§‘å­¦å†™ä½œæå‡ç”Ÿç‰©å­¦å®è·µèƒ½åŠ›ã€‚"
  },
  {
    id:"iad_media",
    title_en:"Digital Media",
    title_zh:"æ•°å­—åª’ä½“",
    category:"iad_2",
    color:"orange",
    desc_en:"Combines creative design with digital tools to produce media products such as video, graphics and online content.",
    desc_zh:"ç»“åˆåˆ›æ„è®¾è®¡ä¸æ•°å­—å·¥å…·ï¼Œå®Œæˆè§†é¢‘ã€å›¾åƒä¸çº¿ä¸Šå†…å®¹ç­‰å¤šç§åª’ä½“ä½œå“ï¼Œç†è§£ç°ä»£ä¼ æ’­æ–¹å¼ã€‚"
  },

  {
    id:"iad_phys",
    title_en:"Physics",
    title_zh:"ç‰©ç†",
    category:"iad_3",
    color:"green",
    desc_en:"Covers motion, forces, electricity and waves, using experiments and mathematical models to explain the physical world.",
    desc_zh:"å­¦ä¹ è¿åŠ¨ã€åŠ›å­¦ã€ç”µå­¦ä¸æ³¢åŠ¨ç­‰å†…å®¹ï¼Œé€šè¿‡å®éªŒä¸æ•°å­¦å»ºæ¨¡è§£é‡Šç‰©ç†ç°è±¡ã€‚"
  },
  {
    id:"iad_math",
    title_en:"Mathematics",
    title_zh:"æ•°å­¦",
    category:"iad_3",
    color:"purple",
    desc_en:"Develops algebra, calculus and data-handling skills that support science, engineering, business and social science pathways.",
    desc_zh:"ç³»ç»Ÿæå‡ä»£æ•°ã€å¾®ç§¯åˆ†ä¸æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œä¸ºæœªæ¥åœ¨ç†å·¥ç§‘ã€å•†ç§‘ä¸ç¤¾ä¼šç§‘å­¦ç­‰é¢†åŸŸå­¦ä¹ æä¾›æ•°å­¦åŸºç¡€ã€‚"
  },
  {
    id:"iad_music",
    title_en:"Music",
    title_zh:"éŸ³ä¹",
    category:"iad_3",
    color:"yellow",
    desc_en:"Combines performance, analysis and composition, encouraging students to develop their own musical voice across styles.",
    desc_zh:"é€šè¿‡è¡¨æ¼”ã€åˆ†æä¸åˆ›ä½œç­‰å­¦ä¹ æ´»åŠ¨ï¼Œé¼“åŠ±å­¦ç”Ÿåœ¨ä¸åŒé£æ ¼ä¸­å½¢æˆä¸ªäººçš„éŸ³ä¹è¡¨è¾¾ã€‚"
  },

  {
    id:"iad_chem",
    title_en:"Chemistry",
    title_zh:"åŒ–å­¦",
    category:"iad_4",
    color:"orange",
    desc_en:"Focuses on atomic structure, bonding, energetics and reaction rates, with regular laboratory work to build practical skills.",
    desc_zh:"é‡ç‚¹å­¦ä¹ åŸå­ç»“æ„ã€åŒ–å­¦é”®ã€èƒ½é‡å˜åŒ–ä¸ååº”é€Ÿç‡ç­‰å†…å®¹ï¼Œå¹¶é€šè¿‡å®éªŒè®­ç»ƒæå‡åŒ–å­¦å®è·µèƒ½åŠ›ã€‚"
  },
  {
    id:"iad_math2",
    title_en:"Further Maths",
    title_zh:"è¿›é˜¶æ•°å­¦",
    category:"iad_4",
    color:"purple",
    desc_en:"Extends mathematics into more advanced topics such as complex numbers and matrices, ideal for students aiming at highly quantitative degrees.",
    desc_zh:"åœ¨æ ¸å¿ƒæ•°å­¦åŸºç¡€ä¸Šæ‹“å±•è‡³å¤æ•°ã€çŸ©é˜µç­‰é«˜é˜¶å†…å®¹ï¼Œé€‚åˆè®¡åˆ’æ”»è¯»é«˜åº¦é‡åŒ–ä¸“ä¸šçš„å­¦ç”Ÿã€‚"
  },
  {
    id:"iad_va",
    title_en:"Visual Arts",
    title_zh:"è§†è§‰è‰ºæœ¯",
    category:"iad_4",
    color:"yellow",
    desc_en:"Develops a personal art portfolio through drawing, painting and mixed media, emphasising idea development and reflection.",
    desc_zh:"é€šè¿‡ç´ æã€ç»˜ç”»ä¸ç»¼åˆææ–™åˆ›ä½œä¸ªäººä½œå“é›†ï¼Œé‡è§†åˆ›æ„æ„æ€è¿‡ç¨‹ä¸è‡ªæˆ‘åæ€ã€‚"
  }
];

/* ============================================================
   Block definitions by mode
   ============================================================ */
const grade9Blocks = [
  { id:"g9_b1", title:"Chinese / ä¸­æ–‡",           subtitle:"Chinese Language & Literature / ä¸­æ–‡è¯­è¨€ä¸æ–‡å­¦",         allowed:["g9_chinese"],   theme:"red" },
  { id:"g9_b2", title:"English / è‹±è¯­",           subtitle:"English A/B/Enhanced / è‹±è¯­A/B æˆ–è‹±è¯­å¼ºåŒ–",             allowed:["g9_english"],   theme:"blue" },
  { id:"g9_b3", title:"Mathematics / æ•°å­¦",       subtitle:"Higher or Standard / é«˜é˜¶æˆ–æ ‡å‡†æ•°å­¦",                   allowed:["g9_math"],      theme:"purple" },
  { id:"g9_b4", title:"Science / ç§‘å­¦",           subtitle:"Physics or Biology / ç‰©ç†æˆ–ç”Ÿç‰©",                       allowed:["g9_science_p"], theme:"green" },
  { id:"g9_b5", title:"Science / ç§‘å­¦",           subtitle:"Chemistry or Health Science / åŒ–å­¦æˆ–å¥åº·ç§‘å­¦",          allowed:["g9_science_s"], theme:"orange" },
  { id:"g9_b6", title:"Arts & Humanities / è‰ºæœ¯ä¸äººæ–‡", subtitle:"Music or Global Perspectives / éŸ³ä¹æˆ–å…¨çƒè§†é‡",   allowed:["g9_arts_hum"],  theme:"yellow" },
  { id:"g9_b7", title:"Arts & Design / è‰ºæœ¯ä¸è®¾è®¡", subtitle:"Art or Design Thinking / è‰ºæœ¯æˆ–è®¾è®¡æ€ç»´",            allowed:["g9_arts_des"],  theme:"yellow" },
  { id:"g9_b8", title:"Personalised / ä¸ªæ€§åŒ–",    subtitle:"Leadership credential / é¢†å¯¼åŠ›é¡¹ç›®",                   allowed:["g9_personal"],  theme:"gold" }
];

const grade10Blocks = [
  { id:"g10_b1", title:"Chinese / ä¸­æ–‡",          subtitle:"Core Chinese Language & Literature / ä¸­æ–‡è¯­è¨€ä¸æ–‡å­¦ï¼ˆæ ¸å¿ƒï¼‰",   allowed:["g10_chinese"], theme:"red" },
  { id:"g10_b2", title:"English / è‹±è¯­",          subtitle:"Language & Literature / Enhanced / è¯­è¨€ä¸æ–‡å­¦æˆ–è‹±è¯­å¼ºåŒ–",      allowed:["g10_english"], theme:"blue" },
  { id:"g10_b3", title:"Mathematics / æ•°å­¦",      subtitle:"Core or Extended Mathematics / æ ¸å¿ƒæˆ–æ‰©å±•æ•°å­¦",                allowed:["g10_math"],    theme:"purple" },
  { id:"g10_b4", title:"Sciences / ç§‘å­¦",         subtitle:"Physics / Chemistry / Biology / ç‰©ç†ã€åŒ–å­¦æˆ–ç”Ÿç‰©",             allowed:["g10_science"], theme:"green" },
  { id:"g10_b5", title:"Humanities / äººæ–‡å­¦ç§‘",   subtitle:"History or Geography / å†å²æˆ–åœ°ç†",                          allowed:["g10_hum"],     theme:"yellow" },
  { id:"g10_b6", title:"Arts / è‰ºæœ¯",             subtitle:"Art & Design / Music / è‰ºæœ¯ä¸è®¾è®¡æˆ–éŸ³ä¹",                    allowed:["g10_art"],     theme:"yellow" },
  { id:"g10_b7", title:"Core Curriculum / æ ¸å¿ƒè¯¾ç¨‹", subtitle:"Sport, Wellbeing, or Qidi / ä½“è‚²ã€èº«å¿ƒå¥åº·æˆ–å¯è¿ªè¯¾",       allowed:["g10_core"],    theme:"gold" }
];

const ibBlocks = [
  { id:"ib_b1", title:"Language A / è¯­è¨€A",                 subtitle:"English A or Chinese A / è‹±è¯­A æˆ–ä¸­æ–‡A",                  allowed:["ib_langA"], theme:"red" },
  { id:"ib_b2", title:"Language B / è¯­è¨€B",                 subtitle:"English B or Chinese B / è‹±è¯­B æˆ–ä¸­æ–‡B",                  allowed:["ib_langB"], theme:"blue" },
  { id:"ib_b3", title:"Individuals & Societies / ä¸ªä½“ä¸ç¤¾ä¼š", subtitle:"Economics / Psychology / ç»æµå­¦æˆ–å¿ƒç†å­¦",              allowed:["ib_soc"],   theme:"yellow" },
  { id:"ib_b4", title:"Sciences / ç§‘å­¦",                   subtitle:"Biology / Physics / ç”Ÿç‰©æˆ–ç‰©ç†",                            allowed:["ib_sci"],   theme:"green" },
  { id:"ib_b5", title:"Mathematics / æ•°å­¦",                subtitle:"AA or AI / æ•°å­¦AA æˆ–æ•°å­¦AI",                               allowed:["ib_math"],  theme:"purple" },
  { id:"ib_b6", title:"Arts / Elective / è‰ºæœ¯æˆ–é€‰ä¿®",       subtitle:"Visual Arts or second science/soc sci / è§†è§‰è‰ºæœ¯æˆ–ç¬¬äºŒé—¨ç§‘å­¦/ç¤¾ç§‘", allowed:["ib_elec"], theme:"orange" }
];

const iadBlocks = [
  { id:"iad_b1", title:"Block 1 / æ¨¡å— 1", subtitle:"English / Chinese / EPQ / è‹±è¯­ã€ä¸­æ–‡æˆ–EPQé¡¹ç›®",           allowed:["iad_1"], theme:"blue" },
  { id:"iad_b2", title:"Block 2 / æ¨¡å— 2", subtitle:"Business / Biology / Media / å•†ä¸šã€ç”Ÿç‰©æˆ–æ•°å­—åª’ä½“",       allowed:["iad_2"], theme:"yellow" },
  { id:"iad_b3", title:"Block 3 / æ¨¡å— 3", subtitle:"Physics / Math / Music / ç‰©ç†ã€æ•°å­¦æˆ–éŸ³ä¹",              allowed:["iad_3"], theme:"purple" },
  { id:"iad_b4", title:"Block 4 / æ¨¡å— 4", subtitle:"Chemistry / Further Math / Art / åŒ–å­¦ã€è¿›é˜¶æ•°å­¦æˆ–è‰ºæœ¯",  allowed:["iad_4"], theme:"orange" }
];

/* ============================================================
   Helper functions
   ============================================================ */

function getCards() {
  return currentMode === "grade9" ? grade9Cards :
         currentMode === "grade10" ? grade10Cards :
         currentMode === "ibdp"   ? ibdpCards :
         iadCards;
}

function getBlocks() {
  return currentMode === "grade9" ? grade9Blocks :
         currentMode === "grade10" ? grade10Blocks :
         currentMode === "ibdp"   ? ibBlocks :
         iadBlocks;
}

function captureCurrentSelections() {
  const map = savedSelections[currentMode];
  if (!map) return;

  // Clear existing stored selections for this mode
  Object.keys(map).forEach(k => delete map[k]);

  // Read current DOM blocks and store card selections
  document.querySelectorAll(".block").forEach(blockEl => {
    const blockId = blockEl.dataset.blockId;
    const cardEl = blockEl.querySelector(".card");
    if (blockId && cardEl) {
      map[blockId] = cardEl.dataset.cardId;
    }
  });
}

function restoreSelectionsForMode(mode) {
  const map = savedSelections[mode];
  if (!map) return;

  Object.keys(map).forEach(blockId => {
    const cardId = map[blockId];
    const cardEl = document.querySelector(`#available-grid .card[data-card-id="${cardId}"]`);
    const blockEl = document.querySelector(`.block[data-block-id="${blockId}"]`);
    if (cardEl && blockEl) {
      const ph = blockEl.querySelector(".placeholder");
      if (ph) ph.remove();
      blockEl.appendChild(cardEl);
    }
  });
}

/* ============================================================
   Render cards
   ============================================================ */
function renderCards() {
  const container = document.getElementById("available-grid");
  container.innerHTML = "";

  getCards().forEach(card => {
    const div = document.createElement("div");
    div.className = `card ${card.color}`;
    div.dataset.cardId = card.id;
    div.dataset.category = card.category;

    if (card.desc_en) div.dataset.descEn = card.desc_en;
    if (card.desc_zh) div.dataset.descZh = card.desc_zh;

    div.innerHTML = `
      <div class="card-title">${card.title_en}</div>
      <div class="card-title-zh">${card.title_zh}</div>
    `;
    container.appendChild(div);
  });
}

/* ============================================================
   Render blocks
   ============================================================ */
function renderBlocks() {
  const container = document.getElementById("blocks");
  container.innerHTML = "";

  getBlocks().forEach(block => {
    const wrap = document.createElement("div");
    wrap.className = "block" + (block.theme ? ` block-${block.theme}` : "");
    wrap.dataset.blockId = block.id;
    wrap.dataset.allowed = block.allowed.join(",");

    wrap.innerHTML = `
      <div class="block-title">${block.title}</div>
      <div class="block-subtitle">${block.subtitle}</div>
      <div class="placeholder">Drag course here / è¯·å°†è¯¾ç¨‹æ‹–åˆ°æ­¤å¤„</div>
    `;

    container.appendChild(wrap);
  });
}

/* ============================================================
   Drag and drop setup with validation
   ============================================================ */
let currentSortables = [];

function setupDragDrop() {
  currentSortables.forEach(s => s.destroy());
  currentSortables = [];

  /* Available area */
  currentSortables.push(new Sortable(document.getElementById("available-grid"), {
    group: { name:"courses", pull:true, put:true },
    sort: false,
    animation: 150
  }));

  /* Blocks */
  document.querySelectorAll(".block").forEach(block => {
    const s = new Sortable(block, {
      group: { name:"courses", pull:true, put:true },
      sort: false,
      animation: 150,

      onAdd(evt) {
        const item = evt.item;
        const cardCat = item.dataset.category;
        const allowed = block.dataset.allowed.split(",");

        if (!allowed.includes(cardCat)) {
          alert("This course cannot be placed in this block. / æ­¤è¯¾ç¨‹ä¸èƒ½æ”¾åœ¨æ­¤æ¨¡å—ä¸­ã€‚");
          block.removeChild(item);
          document.getElementById("available-grid").appendChild(item);
          return;
        }

        /* remove placeholder */
        const ph = block.querySelector(".placeholder");
        if (ph) ph.remove();

        /* enforce one card per block */
        [...block.querySelectorAll(".card")].slice(0, -1).forEach(old => {
          block.removeChild(old);
          document.getElementById("available-grid").appendChild(old);
        });
      },

      onRemove(evt) {
        if (!block.querySelector(".card")) {
          block.innerHTML += `<div class="placeholder">Drag course here / è¯·å°†è¯¾ç¨‹æ‹–åˆ°æ­¤å¤„</div>`;
        }
      }
    });

    currentSortables.push(s);
  });
}

/* ============================================================
   Mode switching
   ============================================================ */
function switchMode(mode) {
  // Save selections for the current mode before switching
  captureCurrentSelections();

  currentMode = mode;

  /* Update UI text */
  document.getElementById("available-title").textContent =
    mode === "grade9"  ? "Available Grade 9 Courses / ä¹å¹´çº§å¯é€‰è¯¾ç¨‹"  :
    mode === "grade10" ? "Available Grade 10 Courses / åå¹´çº§å¯é€‰è¯¾ç¨‹" :
    mode === "ibdp"    ? "IBDP Subjects / IBDP è¯¾ç¨‹"                 :
                         "IAD Subjects / IAD è¯¾ç¨‹";

  document.getElementById("pathway-title").textContent =
    mode === "grade9"  ? "My Grade 9 Pathway / æˆ‘çš„ä¹å¹´çº§å­¦ä¹ è·¯å¾„"   :
    mode === "grade10" ? "My Grade 10 Pathway / æˆ‘çš„åå¹´çº§å­¦ä¹ è·¯å¾„"  :
    mode === "ibdp"    ? "My IBDP Preview / æˆ‘çš„IBDPè¯¾ç¨‹é¢„è§ˆ"       :
                         "My IAD Preview / æˆ‘çš„IADè¯¾ç¨‹é¢„è§ˆ";

  /* Update active mode card */
  document.querySelectorAll(".mode-card").forEach(c => c.classList.remove("active"));
  document.querySelector(`.mode-card[data-mode="${mode}"]`).classList.add("active");

  renderCards();
  renderBlocks();

  // Restore selections (if any) for the newly selected mode
  restoreSelectionsForMode(mode);

  setupDragDrop();
}

/* ============================================================
   Reset current mode
   ============================================================ */
document.getElementById("reset-button").addEventListener("click", () => {
  switchMode(currentMode);
});

/* ============================================================
   Mode configuration (shared for export/preview)
   ============================================================ */
const modeConfigs = [
  { key: "grade9",  label: "Grade 9",  labelZh: "ä¹å¹´çº§", blocks: grade9Blocks,  cards: grade9Cards },
  { key: "grade10", label: "Grade 10", labelZh: "åå¹´çº§", blocks: grade10Blocks, cards: grade10Cards },
  { key: "ibdp",    label: "IBDP",     labelZh: "IBDP",  blocks: ibBlocks,      cards: ibdpCards },
  { key: "iad",     label: "IAD",      labelZh: "IAD",   blocks: iadBlocks,     cards: iadCards }
];

/* ============================================================
   Export to CSV & preview overlay
   ============================================================ */
function exportToCsv() {
  // Ensure selections are current
  captureCurrentSelections();

  const rows = [];

  // Capture student info
  const studentEnglishName = document.getElementById("student-ename").value || "";
  const studentChineseName = document.getElementById("student-cname").value || "";
  const studentGrade       = document.getElementById("student-grade").value || "";
  const studentExisting    = document.getElementById("student-existing").value || "";
  const submissionTime     = new Date().toLocaleString(); // browser local time

  // Metadata header and values
  rows.push([
    "studentEnglishName",
    "studentChineseName",
    "currentGrade",
    "existingDehongStudent",
    "submissionTimestamp"
  ]);

  rows.push([
    studentEnglishName,
    studentChineseName,
    studentGrade,
    studentExisting,
    submissionTime
  ]);

  // Blank line separator
  rows.push([]);

  // Pathway selections header (include mode)
  rows.push(["mode", "blockId", "blockTitle", "courseId", "courseTitleEn", "courseTitleZh"]);

  modeConfigs.forEach(cfg => {
    const map = savedSelections[cfg.key];

    cfg.blocks.forEach(block => {
      const cardId = map[block.id];
      if (cardId) {
        const card = cfg.cards.find(c => c.id === cardId);
        if (card) {
          rows.push([
            cfg.label,
            block.id,
            block.title,
            card.id,
            card.title_en,
            card.title_zh
          ]);
        } else {
          rows.push([cfg.label, block.id, block.title, "", "", ""]);
        }
      } else {
        rows.push([cfg.label, block.id, block.title, "", "", ""]);
      }
    });
  });

  const csv = rows.map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `dehong_all_pathways.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

function showPreview() {
  // Ensure we have the latest selections
  captureCurrentSelections();

  const overlay = document.getElementById("preview-overlay");
  const body = document.getElementById("preview-body");
  body.innerHTML = "";

  // Student info
  const studentEnglishName = document.getElementById("student-ename").value || "(not provided) / ï¼ˆæœªå¡«å†™ï¼‰";
  const studentChineseName = document.getElementById("student-cname").value || "ï¼ˆæœªå¡«å†™ï¼‰";
  const studentGrade       = document.getElementById("student-grade").value || "ï¼ˆæœªå¡«å†™ï¼‰";
  const studentExisting    = document.getElementById("student-existing").value || "ï¼ˆæœªé€‰æ‹©ï¼‰";

  body.innerHTML += `
    <h3>Student Information / å­¦ç”Ÿä¿¡æ¯</h3>
    <p><strong>English Name / è‹±æ–‡å§“åï¼š</strong> ${studentEnglishName}</p>
    <p><strong>Chinese Name / ä¸­æ–‡å§“åï¼š</strong> ${studentChineseName}</p>
    <p><strong>Current Grade / å½“å‰å¹´çº§ï¼š</strong> ${studentGrade}</p>
    <p><strong>Existing Dehong Student? / æ˜¯å¦ä¸ºåœ¨è¯»å¾·é—³å­¦ç”Ÿï¼Ÿ</strong> ${studentExisting}</p>
    <hr style="border:none;border-top:1px solid #2A3040;margin:10px 0 6px;" />
  `;

  let anyModeHasSelection = false;

  // Pathway previews â€” only show modes with at least one selected course
  modeConfigs.forEach(cfg => {
    const map = savedSelections[cfg.key];
    if (!map) return;

    let modeHasSelection = false;
    let rowsHtml = "";

    cfg.blocks.forEach(block => {
      const cardId = map[block.id];
      let cellHtml;
      if (cardId) {
        const card = cfg.cards.find(c => c.id === cardId);
        if (card) {
          cellHtml = `${card.title_en} / ${card.title_zh}`;
          modeHasSelection = true;
        } else {
          cellHtml = `<span class="preview-tag-empty">Not found / æœªæ‰¾åˆ°</span>`;
        }
      } else {
        cellHtml = `<span class="preview-tag-empty">Not selected / æœªé€‰æ‹©</span>`;
      }

      rowsHtml += `
        <tr>
          <td>${block.title}</td>
          <td>${cellHtml}</td>
        </tr>
      `;
    });

    // Skip this mode if the student has not selected any course in it
    if (!modeHasSelection) return;

    anyModeHasSelection = true;

    body.innerHTML += `
      <div class="preview-mode-section">
        <div class="preview-mode-header">
          <div class="preview-mode-title">
            ${cfg.label} Pathway / ${cfg.labelZh} è·¯å¾„
          </div>
          <div class="preview-mode-chip">
            Filled for this pathway / å·²å¡«å†™æ­¤è·¯å¾„
          </div>
        </div>
        <table class="preview-table">
          <thead>
            <tr>
              <th>Block / æ¨¡å—</th>
              <th>Selected Course / å·²é€‰è¯¾ç¨‹</th>
            </tr>
          </thead>
          <tbody>
            ${rowsHtml}
          </tbody>
        </table>
      </div>
    `;
  });

  // If no modes have any selections at all, show a gentle message
  if (!anyModeHasSelection) {
    body.innerHTML += `
      <p class="preview-tag-empty">
        No courses selected yet. Please drag courses into the blocks on the right before exporting.
        / å°šæœªé€‰æ‹©ä»»ä½•è¯¾ç¨‹ã€‚è¯·å…ˆå°†è¯¾ç¨‹æ‹–å…¥å³ä¾§æ¨¡å—ï¼Œç„¶åå†è¿›è¡Œå¯¼å‡ºã€‚
      </p>
    `;
  }

  overlay.style.display = "flex";
}

// Export button now opens preview
document.getElementById("export-button").addEventListener("click", showPreview);

// Preview close + confirm buttons
document.getElementById("preview-close").addEventListener("click", () => {
  document.getElementById("preview-overlay").style.display = "none";
});

document.getElementById("preview-export").addEventListener("click", () => {
  exportToCsv();
  document.getElementById("preview-overlay").style.display = "none";
});


/* ============================================================
   Card tooltip logic (hover descriptions)
   ============================================================ */
const tooltipEl = document.createElement("div");
tooltipEl.id = "card-tooltip";
tooltipEl.innerHTML = "";
document.body.appendChild(tooltipEl);

function showCardTooltip(card, clientX, clientY) {
  // Read title and bilingual description directly from the DOM dataset
  const titleText = card.querySelector(".card-title")?.textContent || "";
  const zhTitleText = card.querySelector(".card-title-zh")?.textContent || "";

  const enDesc = card.dataset.descEn || "";
  const zhDesc = card.dataset.descZh || "";

  const bodyLines = [];

  // Prefer full descriptions if present (e.g. Grade 9 cards)
  if (enDesc) bodyLines.push(`<p>${enDesc}</p>`);
  if (zhDesc) bodyLines.push(`<p>${zhDesc}</p>`);

  // Fallback: if no description is set, show the titles as the body
  if (!bodyLines.length) {
    if (titleText) bodyLines.push(`<p>${titleText}</p>`);
    if (zhTitleText) bodyLines.push(`<p>${zhTitleText}</p>`);
  }

  if (!bodyLines.length) {
    tooltipEl.style.display = "none";
    return;
  }

  tooltipEl.innerHTML = `
    <div class="tooltip-title">${titleText}${zhTitleText ? " / " + zhTitleText : ""}</div>
    <div class="tooltip-body">
      ${bodyLines.join("")}
    </div>
  `;

  const padding = 14;
  let left = clientX + 16;
  let top = clientY + 16;

  const rect = tooltipEl.getBoundingClientRect();
  const vw = window.innerWidth;
  const vh = window.innerHeight;

  if (left + rect.width + padding > vw) {
    left = clientX - rect.width - 16;
  }
  if (top + rect.height + padding > vh) {
    top = clientY - rect.height - 16;
  }

  tooltipEl.style.left = `${left}px`;
  tooltipEl.style.top = `${top}px`;
  tooltipEl.style.display = "block";
}

function hideCardTooltip() {
  tooltipEl.style.display = "none";
}

// Event delegation so it works in both the middle panel and blocks
document.addEventListener("mousemove", (e) => {
  const card = e.target.closest(".card");
  if (card) {
    showCardTooltip(card, e.clientX, e.clientY);
  } else {
    hideCardTooltip();
  }
});

/* ============================================================
   Mode card click handlers
   ============================================================ */
document.querySelectorAll(".mode-card").forEach(card => {
  card.addEventListener("click", () => {
    switchMode(card.dataset.mode);
  });
});

/* ============================================================
   Initialise
   ============================================================ */
switchMode("grade9");
</script>